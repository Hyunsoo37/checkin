<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>심리 검사 결과</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0fdf4;
      margin: 0;
      padding: 40px 20px;
      color: #065f46;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 50px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      text-align: center;
    }
    h1 {
      font-size: 32px;
      color: #047857;
    }
    p {
      font-size: 18px;
      margin-top: 30px;
    }
    .score-box {
      margin-top: 40px;
      font-size: 18px;
      background: #ecfdf5;
      padding: 20px;
      border-radius: 12px;
      font-weight: normal;
      text-align: left;
      line-height: 1.6;
      white-space: pre-line;
    }
    .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      overflow: auto;
    }
    .preview-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      width: 80%;
      max-width: 800px;
      border-radius: 12px;
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    .preview-iframe {
      width: 100%;
      height: 80vh;
      border: none;
      border-radius: 8px;
      margin-top: 20px;
      background: white;
      padding: 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .preview-inner {
      width: 700px;
      max-width: 100%;
      padding: 20px;
      background: white;
      border-radius: 12px;
    }
    .home-btn, .pdf-btn, .preview-btn {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
      transition: background 0.3s;
    }
    .preview-btn {
      background: #3b82f6;
    }
    .home-btn:hover, .pdf-btn:hover {
      background: #059669;
    }
    .preview-btn:hover {
      background: #2563eb;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    @media print {
      .no-print {
        display: none;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="container" id="pdf-content">
    <h1>검사 결과</h1>
    <p>당신의 심리적 특성은 아래와 같습니다:</p>
    <div class="score-box" id="scoreBox">결과 계산 중...</div>

    <div class="btn-group">
      <button class="preview-btn no-print" onclick="showPreview()">PDF 미리보기</button>
      <button class="pdf-btn no-print" onclick="generatePDF()">PDF로 저장하기</button>
      <button class="pdf-btn no-print" onclick="window.print()">인쇄하기</button>
      <button class="home-btn no-print" onclick="goHome()">홈으로 돌아가기</button>
    </div>
  </div>

  <div id="previewModal" class="preview-modal no-print">
    <div class="preview-content">
      <span class="close-btn" onclick="closePreview()">&times;</span>
      <h2>PDF 미리보기</h2>
      <p>아래는 PDF로 변환될 내용의 미리보기입니다. 확인 후 다운로드 또는 인쇄를 진행해주세요.</p>
      <div id="pdf-preview" class="preview-iframe"></div>
      <div style="margin-top: 20px;">
        <button class="pdf-btn" onclick="generatePDF()">PDF로 저장하기</button>
        <button class="pdf-btn" onclick="window.print()">인쇄하기</button>
        <button class="home-btn" onclick="closePreview()">닫기</button>
      </div>
    </div>
  </div>

  <script>
    const rawScore = Math.floor(Math.random() * 61) - 30;
    const score = Math.max(0, rawScore + 30);
    const scoreBox = document.getElementById("scoreBox");

    let message = `점수: ${score}점\n\n`;

    if (score >= 51) {
      message += `당신은 매우 외향적이며 사람들과 함께 있을 때 에너지를 얻는 경향이 있습니다. 새로운 사람들과의 만남이나 활동에 대한 두려움이 거의 없으며, 타인과의 상호작용을 통해 기쁨을 느낍니다. 감정 표현이 풍부하며, 사람들을 이끄는 리더십을 보이기도 합니다. 또한 강한 자신감과 주도성을 가지고 있어 사회적 관계에서도 주도적인 역할을 수행하는 경향이 있습니다.`;
    } else if (score >= 41) {
      message += `당신은 외향적인 성향이 있으며 활발한 사회적 활동을 즐깁니다. 타인과의 소통에서 편안함을 느끼고, 의견 표현에도 주저함이 없습니다. 새로운 환경에도 비교적 빠르게 적응하며, 주변 사람들과 긍정적인 관계를 형성하는 데 능숙합니다.`;
    } else if (score >= 31) {
      message += `당신은 다소 외향적인 성격을 가지고 있으며, 감정 표현과 타인에 대한 공감 능력이 뛰어납니다. 조용한 환경도 선호하지만 사람들과 함께 있는 시간을 중요하게 여기며, 균형 잡힌 대인관계를 유지하려 노력합니다.`;
    } else if (score >= 21) {
      message += `당신은 외향성과 내향성의 중간 지점에 있는 성향으로, 상황에 따라 적절히 대응할 수 있는 유연함을 갖추고 있습니다. 혼자 있는 시간과 사회적 활동 모두에서 에너지를 얻을 수 있으며, 중립적이고 균형 잡힌 성격으로 다양한 상황에 잘 적응합니다.`;
    } else if (score >= 11) {
      message += `당신은 다소 내향적인 성격으로, 조용하고 신중한 태도를 가지고 있습니다. 사적인 공간과 혼자만의 시간이 중요하며, 깊이 있는 관계를 선호합니다. 타인과의 소통보다는 자기 성찰을 통해 내면을 탐색하는 것을 더 선호합니다.`;
    } else if (score >= 1) {
      message += `당신은 내향적인 성향을 가지며 혼자 있는 것을 통해 에너지를 회복합니다. 관찰력이 뛰어나고 상황을 신중히 판단하며, 감정 표현보다는 내면의 안정감을 중시합니다. 깊은 생각과 분석을 통해 문제를 해결하는 경향이 있습니다.`;
    } else {
      message += `당신은 매우 내향적인 성향으로, 내면 세계에 깊이 몰입하는 경향이 강합니다. 혼자만의 시간에서 안정과 만족을 찾으며, 감정 표현은 제한적이고 조용한 환경에서 최고의 능력을 발휘합니다. 자기 성찰과 사색을 통해 삶을 바라보며, 타인의 시선보다는 자신의 기준을 더욱 중요시합니다.`;
    }

    scoreBox.innerText = message;

    function goHome() {
      window.location.href = "심리체크인.html";
    }

    function generatePDF() {
      const element = document.getElementById("pdf-content");
      html2pdf().set({
        filename: '심리검사결과.pdf',
        html2canvas: { scale: 2 },
        jsPDF: { format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }

    function showPreview() {
      const element = document.getElementById("pdf-content");
      const modal = document.getElementById("previewModal");
      const previewContainer = document.getElementById("pdf-preview");
      previewContainer.innerHTML = '';
      const clone = element.cloneNode(true);
      const buttons = clone.querySelectorAll('.btn-group');
      buttons.forEach(btn => btn.remove());
      clone.classList.remove('container');
      clone.style.width = '700px';
      clone.style.margin = 'auto';
      clone.style.padding = '40px';
      clone.style.boxShadow = 'none';
      const wrapper = document.createElement('div');
      wrapper.className = 'preview-inner';
      wrapper.appendChild(clone);
      previewContainer.appendChild(wrapper);
      modal.style.display = 'block';
    }

    function closePreview() {
      document.getElementById("previewModal").style.display = 'none';
    }

    window.onclick = function(event) {
      const modal = document.getElementById("previewModal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>
