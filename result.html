<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>심리 검사 결과</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0fdf4;
      margin: 0;
      padding: 40px 20px;
      color: #065f46;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 50px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      text-align: center;
    }
    h1 {
      font-size: 36px;
      color: #047857;
    }
    p {
      font-size: 20px;
      margin-top: 30px;
    }
    .score-box, .detail-box, .category-box, .extra-box {
      margin-top: 40px;
      font-size: 18px;
      background: #ecfdf5;
      padding: 20px;
      border-radius: 12px;
      font-weight: normal;
      text-align: left;
      line-height: 1.6;
      white-space: pre-line;
    }
    .category-box h3, .extra-box h3 {
      color: #047857;
      margin-bottom: 10px;
    }
    .category-box ul, .extra-box ul {
      list-style: none;
      padding: 0;
    }
    .category-box li::before, .extra-box li::before {
      content: '✔';
      margin-right: 8px;
      color: #10b981;
    }
    .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      overflow: auto;
    }
    .preview-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      width: 90%;
      max-width: 900px;
      border-radius: 12px;
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    .preview-iframe {
      width: 100%;
      height: 85vh;
      border: none;
      border-radius: 8px;
      margin-top: 20px;
      background: white;
      padding: 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .preview-inner {
      width: 800px;
      max-width: 100%;
      padding: 20px;
      background: white;
      border-radius: 12px;
    }
    .home-btn, .pdf-btn, .preview-btn {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
      transition: background 0.3s;
    }
    .preview-btn {
      background: #3b82f6;
    }
    .home-btn:hover, .pdf-btn:hover {
      background: #059669;
    }
    .preview-btn:hover {
      background: #2563eb;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .cert-mark {
      margin-top: 40px;
      text-align: center;
    }
    .cert-mark img {
      width: 180px;
      opacity: 0.9;
    }
    @media print {
      .no-print {
        display: none;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="container" id="pdf-content">
    <h1>심리검사 결과</h1>
    <p>당신의 심리적 특성은 아래와 같습니다:</p>
    <div class="score-box" id="scoreBox">결과 계산 중...</div>
    <div class="detail-box" id="detailBox"></div>
    <div class="category-box">
      <h3>세부 성향 분석</h3>
      <ul>
        <li>자기 통제력</li>
        <li>사회성 / 대인 관계</li>
        <li>스트레스 반응 유형</li>
        <li>감정 조절 능력</li>
        <li>집중력 및 목표 지향성</li>
      </ul>
    </div>
    <div class="extra-box">
      <h3>추가 해석</h3>
      <ul>
        <li>스트레스 인내력: 높은 편으로 변화에 잘 적응합니다.</li>
        <li>심리적 복원력: 회복 속도가 빠르며, 좌절에 강한 성격입니다.</li>
        <li>감정적 자각력: 자신의 감정을 잘 인식하고 관리할 수 있습니다.</li>
        <li>자기 효능감: 스스로 문제를 해결할 수 있다는 믿음이 강합니다.</li>
        <li>자기 동기부여: 외부 자극보다 내부 동기로 움직이는 성향입니다.</li>
      </ul>
    </div>
    <div class="btn-group">
      <button class="preview-btn no-print" onclick="showPreview()">인증서 미리보기</button>
      <button class="pdf-btn no-print" onclick="generatePDF()">인증서 저장하기</button>
      <button class="pdf-btn no-print" onclick="window.print()">인쇄하기</button>
      <button class="home-btn no-print" onclick="goHome()">홈으로 돌아가기</button>
    </div>
  </div>

  <div id="previewModal" class="preview-modal no-print">
    <div class="preview-content">
      <span class="close-btn" onclick="closePreview()">&times;</span>
      <h2>인증서 미리보기</h2>
      <p>아래는 PDF로 변환될 내용의 미리보기입니다. 확인 후 다운로드 또는 인쇄를 진행해주세요.</p>
      <div id="pdf-preview" class="preview-iframe"></div>
      <div style="margin-top: 20px;">
        <button class="pdf-btn" onclick="generatePDF()">PDF로 저장하기</button>
        <button class="pdf-btn" onclick="window.print()">인쇄하기</button>
        <button class="home-btn" onclick="closePreview()">닫기</button>
      </div>
    </div>
  </div>

  <script>
    const rawScore = Math.floor(Math.random() * 61) - 30;
    const score = Math.max(0, rawScore + 30);
    const scoreBox = document.getElementById("scoreBox");
    const detailBox = document.getElementById("detailBox");

    let message = `점수: ${score}점\n\n`;
    let detail = '';

    if (score >= 51) {
      message += `당신은 매우 외향적인 성격입니다.`;
      detail += `✔ 사교성: 높음\n✔ 감정 표현: 풍부\n✔ 리더십: 강함\n✔ 대인관계에서 주도적이고 적극적입니다.`;
    } else if (score >= 41) {
      message += `당신은 외향적인 성향을 가지고 있습니다.`;
      detail += `✔ 사람들과의 교류를 즐기며\n✔ 새로운 환경에 잘 적응하고\n✔ 의견 표현에도 능숙합니다.`;
    } else if (score >= 31) {
      message += `당신은 다소 외향적인 성격입니다.`;
      detail += `✔ 감정적 공감 능력이 좋으며\n✔ 균형 잡힌 대인관계를 유지합니다.`;
    } else if (score >= 21) {
      message += `당신은 중립적인 성격입니다.`;
      detail += `✔ 외향성과 내향성 사이의 균형\n✔ 유연한 사고방식\n✔ 다양한 상황에 잘 적응합니다.`;
    } else if (score >= 11) {
      message += `당신은 다소 내향적인 성격입니다.`;
      detail += `✔ 조용하고 신중하며\n✔ 깊이 있는 관계를 선호합니다.`;
    } else if (score >= 1) {
      message += `당신은 내향적인 성향입니다.`;
      detail += `✔ 혼자 있는 시간에 에너지를 얻고\n✔ 감정보다 이성에 집중합니다.`;
    } else {
      message += `당신은 매우 내향적인 성향입니다.`;
      detail += `✔ 깊은 사색과 자기 성찰을 즐기며\n✔ 독립적 사고가 강합니다.`;
    }

    scoreBox.innerText = message;
    detailBox.innerText = detail;

    function goHome() {
      window.location.href = "심리체크인.html";
    }

    function generatePDF() {
      const element = document.getElementById("pdf-content");
      html2pdf().set({
        filename: '심리검사결과.pdf',
        html2canvas: { scale: 2 },
        jsPDF: { format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }

    function showPreview() {
      const element = document.getElementById("pdf-content");
      const modal = document.getElementById("previewModal");
      const previewContainer = document.getElementById("pdf-preview");
      previewContainer.innerHTML = '';
      const clone = element.cloneNode(true);
      const buttons = clone.querySelectorAll('.btn-group');
      buttons.forEach(btn => btn.remove());
      clone.classList.remove('container');
      clone.style.width = '800px';
      clone.style.margin = 'auto';
      clone.style.padding = '40px';
      clone.style.boxShadow = 'none';

      const cert = document.createElement('div');
      cert.className = 'cert-mark';
      cert.innerHTML = '<img src="/mnt/data/경기도 G마크.jpg" alt="경기도지사 인증 마크">';
      clone.appendChild(cert);

      const wrapper = document.createElement('div');
      wrapper.className = 'preview-inner';
      wrapper.appendChild(clone);
      previewContainer.appendChild(wrapper);
      modal.style.display = 'block';
    }

    function closePreview() {
      document.getElementById("previewModal").style.display = 'none';
    }

    window.onclick = function(event) {
      const modal = document.getElementById("previewModal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>
